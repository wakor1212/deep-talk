<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Deep Talk Cards</title>
<style>
  body {
    background: #000;
    color: #eee;
    font-family: Arial, sans-serif;
    display: flex;
    height: 100vh;
    justify-content: center;
    align-items: center;
    margin: 0;
    padding: 20px;
    flex-direction: column;
    text-align: center;
  }
  #category {
    font-size: 24px;
    margin-bottom: 10px;
  }
  #question {
    font-size: 20px;
    margin-bottom: 20px;
    min-height: 80px;
  }
  button {
    background: #222;
    color: #eee;
    border: 1px solid #555;
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
    border-radius: 6px;
    margin: 5px;
    user-select: none;
  }
  button:hover {
    background: #444;
  }
</style>
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>

<div id="category"></div>
<div id="question">Loading questions...</div>
<button id="newCardBtn">ðŸŽ² New Question</button>
<button id="shareBtn" style="display:none;">ðŸ”— Share this question</button>

<script>
  // --- Firebase config (à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹€à¸›à¹‡à¸™à¸‚à¸­à¸‡à¸¡à¸¶à¸‡) ---
const firebaseConfig = {
  apiKey: "AIzaSyB6JnclgIZfdSkhyCK-_sKKE6NR3auuVbs",
  authDomain: "deeptalkapp-ab162.firebaseapp.com",
  projectId: "deeptalkapp-ab162",
  storageBucket: "deeptalkapp-ab162.firebasestorage.app",
  messagingSenderId: "17784725064",
  appId: "1:17784725064:web:a4432c0adfe939b06d427d"
};

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const database = firebase.database();

  // --- à¸„à¸³à¸–à¸²à¸¡à¸žà¸£à¹‰à¸­à¸¡à¸«à¸¡à¸§à¸”à¸«à¸¡à¸¹à¹ˆà¹à¸¥à¸° Emoji ---
  const questions = [
    {text: "What part of yourself are you most proud of?","category":"Yourself","emoji":"ðŸ§"},
    {text: "What scares you the most about your future?","category":"Future","emoji":"ðŸ”®"},
    {text: "Have you ever felt betrayed by a friend? How did it affect you?","category":"Friend","emoji":"ðŸ¤"},
    {text: "If you could change one thing about your past, what would it be?","category":"Yourself","emoji":"ðŸ§"},
    {text: "Whatâ€™s a dream you have that youâ€™ve never shared with anyone?","category":"Future","emoji":"ðŸ”®"},
    {text: "How do you know when someone is truly your friend?","category":"Friend","emoji":"ðŸ¤"},
    {text: "When do you feel most vulnerable?","category":"Yourself","emoji":"ðŸ§"},
    {text: "What do you hope your friends remember about you?","category":"Friend","emoji":"ðŸ¤"},
    {text: "Whatâ€™s one thing you want to accomplish in the next 5 years?","category":"Future","emoji":"ðŸ”®"},
    {text: "How do you handle feelings of loneliness?","category":"Yourself","emoji":"ðŸ§"},
    {text: "What does friendship mean to you?","category":"Friend","emoji":"ðŸ¤"},
    {text: "What are you most excited about in your future?","category":"Future","emoji":"ðŸ”®"},
  ];

  let used = new Set();
  let currentQuestion = null;

  // à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸­à¹ˆà¸²à¸™à¸„à¸³à¸–à¸²à¸¡à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰à¹à¸¥à¹‰à¸§à¸ˆà¸²à¸ Firebase
  async function getUsedQuestions() {
    const snapshot = await database.ref('usedQuestions').once('value');
    return snapshot.val() || {};
  }

  // à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸šà¸±à¸™à¸—à¸¶à¸à¸„à¸³à¸–à¸²à¸¡à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰à¹„à¸›à¹à¸¥à¹‰à¸§à¸¥à¸‡ Firebase
  function markQuestionUsed(questionText) {
    const safeKey = questionText.replace(/\./g, '_');
    database.ref('usedQuestions/' + safeKey).set(true);
  }

  // à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸ªà¸¸à¹ˆà¸¡à¸„à¸³à¸–à¸²à¸¡à¸—à¸µà¹ˆà¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸–à¸¹à¸à¹ƒà¸Šà¹‰
  async function newCard() {
    const usedData = await getUsedQuestions();
    used = new Set(Object.keys(usedData));

    const unusedQuestions = questions.filter(q => !used.has(q.text.replace(/\./g, '_')));
    if (unusedQuestions.length === 0) {
      document.getElementById("category").innerText = "";
      document.getElementById("question").innerText = "No more questions!";
      document.getElementById("shareBtn").style.display = 'none';
      return;
    }
    const q = unusedQuestions[Math.floor(Math.random() * unusedQuestions.length)];
    currentQuestion = q;

    document.getElementById("category").innerText = `${q.emoji} ${q.category}`;
    document.getElementById("question").innerText = q.text;

    // à¸šà¸±à¸™à¸—à¸¶à¸à¸„à¸³à¸–à¸²à¸¡à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰à¹ƒà¸™ Firebase
    markQuestionUsed(q.text);
    used.add(q.text.replace(/\./g, '_'));

    // à¹à¸à¹‰à¹„à¸‚ URL à¹€à¸žà¸·à¹ˆà¸­à¹à¸Šà¸£à¹Œà¸„à¸³à¸–à¸²à¸¡à¸™à¸µà¹‰
    const encoded = encodeURIComponent(q.text);
    history.replaceState(null, '', '?q=' + encoded);

    // à¹à¸ªà¸”à¸‡à¸›à¸¸à¹ˆà¸¡à¹à¸Šà¸£à¹Œ
    document.getElementById("shareBtn").style.display = 'inline-block';
  }

  // à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¹à¸Šà¸£à¹Œà¸„à¸³à¸–à¸²à¸¡
  document.getElementById("shareBtn").onclick = () => {
    const url = window.location.href;
    if (navigator.share) {
      navigator.share({
        title: 'Deep Talk Question',
        text: currentQuestion ? currentQuestion.text : '',
        url: url,
      }).catch(() => alert('Sharing failed or canceled.'));
    } else {
      navigator.clipboard.writeText(url).then(() => {
        alert('Link copied to clipboard!');
      });
    }
  };

  // à¸–à¹‰à¸²à¹€à¸›à¸´à¸”à¸”à¹‰à¸§à¸¢ URL à¸—à¸µà¹ˆà¸¡à¸µ ?q= à¹ƒà¸«à¹‰à¹‚à¸Šà¸§à¹Œà¸„à¸³à¸–à¸²à¸¡à¸™à¸±à¹‰à¸™
  window.onload = async () => {
    const params = new URLSearchParams(window.location.search);
    const qText = params.get('q');
    const usedData = await getUsedQuestions();
    used = new Set(Object.keys(usedData));

    if (qText) {
      const decodedText = decodeURIComponent(qText);
      const questionObj = questions.find(q => q.text === decodedText);
      if (questionObj) {
        currentQuestion = questionObj;
        document.getElementById("category").innerText = `${questionObj.emoji} ${questionObj.category}`;
        document.getElementById("question").innerText = questionObj.text;
        document.getElementById("shareBtn").style.display = 'inline-block';
        used.add(questionObj.text.replace(/\./g, '_'));
        markQuestionUsed(questionObj.text);
        return;
      }
    }

    // à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸¡à¸µ query à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆà¹€à¸ˆà¸­à¸„à¸³à¸–à¸²à¸¡à¹ƒà¸™ URL à¹ƒà¸«à¹‰à¸ªà¸¸à¹ˆà¸¡à¸„à¸³à¸–à¸²à¸¡à¹ƒà¸«à¸¡à¹ˆà¹€à¸¥à¸¢
    newCard();
  };

  // à¸›à¸¸à¹ˆà¸¡à¸ªà¸¸à¹ˆà¸¡à¸„à¸³à¸–à¸²à¸¡à¹ƒà¸«à¸¡à¹ˆ
  document.getElementById("newCardBtn").onclick = () => {
    newCard();
  };
</script>

</body>
</html>
